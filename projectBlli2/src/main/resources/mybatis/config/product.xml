<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 <mapper namespace="product"> 
 
 	<resultMap type="blliBigCategoryVO" id="bbcvRM">
 		<result property="bigCategory" column="big_category"/>
 		<result property="categoryId" column="category_id"/>
 	</resultMap>
 	<resultMap type="blliMidCategoryVO" id="bmcvRM">
 		<result property="midCategory" column="mid_category"/>
 		<result property="midCategoryInfo" column="mid_category_info"/>
 		<result property="midCategoryMainPhotoLink" column="mid_category_main_photo_link"/>
 		<result property="whenToUseMin" column="mid_category_whentouse_min"/>
 		<result property="whenToUseMax" column="mid_category_whentouse_max"/>
 		<result property="bigCategory" column="big_category"/>
 		<result property="categoryId" column="category_id"/>
 	</resultMap>
 	<resultMap type="blliNotRecommMidCategoryVO" id="bnrmcvRM">
 		<result property="midCategory" column="mid_category"/>
 		<result property="categoryId" column="category_id"/>
 		<result property="memberId" column="member_id"/>
 	</resultMap>
	<select id="getSmallProduct" resultType="String">
		select small_product from test_small_product
	</select>
	
	<update id="updateBigCategory">
		update blli_big_category set category_id = #{categoryId} where big_category = #{bigCategory}
	</update>
	
	<insert id="insertBigCategory">
		insert into blli_big_category(category_id, big_category) values(#{categoryId}, #{bigCategory})
	</insert>
	
	<select id="getBigCategory" resultMap="bbcvRM">
		select category_id, big_category from blli_big_category
	</select>
	
	<update id="updateMidCategory">
		update blli_mid_category set category_id = #{categoryId} where mid_category = #{midCategory} and big_category = #{bigCategory}
	</update>
	
	<insert id="insertMidCategory">
		insert into blli_mid_category(mid_category, mid_category_main_photo_link, big_category, category_id) values(#{midCategory}, #{midCategoryMainPhotoLink}, #{bigCategory}, #{categoryId})
	</insert>
	
	<select id="getMidCategory" resultMap="bmcvRM">
		select category_id, mid_category from blli_mid_category
	</select>

	<!-- 준영쿼리 시작 -->
	<select id="selectRecommendingMidCategory" resultMap="bmcvRM">
		select  mid_category,mid_category_info,mid_category_main_photo_link,mid_category_whentouse_min,mid_category_whentouse_max,big_category,category_id
		from BLLI_MID_CATEGORY
		where #{babyMonthAge} <![CDATA[ >= mid_category_whentouse_min and #{babyMonthAge} <= ]]> mid_category_whentouse_min
	</select>
	<select id="selectNotRecommMidCategoryList" resultMap="bnrmcvRM">
		select bnrmc.mid_category,bnrmc.category_id,bnrmc.member_Id as noRecommendMidCategory
		from blli_member bm , BLLI_NOT_RECOMM_MID_CATEGORY bnrmc
		where #{memberId} = bnrmc.member_id
	</select>
	
	<insert id="deleteRecommendMidCategory" >
		insert into blli_not_recomm_mid_category (mid_category,member_id,category_id) values (#{midCategory},#{memberId},#{categoryId})
	</insert>
	<select id="selectSameAgeMomBestPickedSmallProductList" parameterType="HashMap" resultMap="">
		<![CDATA[
		select * from (select rownum as rn,SMALL_PRODUCT, MID_CATEGORY,CATEGORY_ID, SMALL_PRODUCT_MAKER, SMALL_PROPDUCT_WHENTOUSE_MIN, SMALL_PROPDUCT_WHENTOUSE_MAX, SMALL_PRODUCT_DIBS_COUNT, 
		SMALL_PRODUCT_MAIN_PHOTO_LINK, SMALL_PRODUCT_SCORE, SMALL_PRODUCT_POSTING_COUNT, NAVER_SHOPPING_LINK, NAVER_SHOPPING_ORDER, PRODUCT_REGISTER_DAY
		from BLLI_SMALL_PRODUCT
		where MID_CATEGORY = #{recommMid} and #{babyMonthAge}  >= SMALL_PROPDUCT_WHENTOUSE_MIN and #{babyMonthAge} <= SMALL_PROPDUCT_WHENTOUSE_MAX
		order by SMALL_PRODUCT_DIBS_COUNT desc) where rn<3
		]]> 
	</select>
	<select id="selectSameAgeMomBestPickedSmallProduct" parameterType="HashMap">
		<![CDATA[
		select * from (select rownum as rn,SMALL_PRODUCT, MID_CATEGORY,CATEGORY_ID, SMALL_PRODUCT_MAKER, SMALL_PROPDUCT_WHENTOUSE_MIN, SMALL_PROPDUCT_WHENTOUSE_MAX, SMALL_PRODUCT_DIBS_COUNT, 
		SMALL_PRODUCT_MAIN_PHOTO_LINK, SMALL_PRODUCT_SCORE, SMALL_PRODUCT_POSTING_COUNT, NAVER_SHOPPING_LINK, NAVER_SHOPPING_ORDER, PRODUCT_REGISTER_DAY
		from BLLI_SMALL_PRODUCT
		where MID_CATEGORY = #{recommMid} and #{babyMonthAge}  >= SMALL_PROPDUCT_WHENTOUSE_MIN and #{babyMonthAge} <= SMALL_PROPDUCT_WHENTOUSE_MAX
		order by SMALL_PRODUCT_DIBS_COUNT desc) where rn=1
		]]> 
	</select>
	<!-- 끝 -->
 </mapper> 		
 
 
 
 
 
 
 
 
 
 
 
 
















